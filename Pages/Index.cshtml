@page
@model IndexModel
@{
    ViewData["Title"] = "Parking Building Management";
}

<div class="parking-container">
    <div class="parking-header">
        <h1>Parking Building Map</h1>
        
        <div class="search-container position-relative">
            <input type="text" id="carSearch" class="form-control" placeholder="Search by plate number" oninput="searchCars(this.value)">
            <div id="searchResults" class="dropdown-menu"></div>
        </div>
        
        <div class="header-controls">
            <div class="legend">
                <span class="legend-item">
                    <div class="spot-indicator available"></div>
                    Available
                </span>
                <span class="legend-item">
                    <div class="spot-indicator occupied"></div>
                    Occupied
                </span>
                <span class="legend-item">
                    <div class="spot-indicator maintenance"></div>
                    Maintenance
                </span>
            </div>
        </div>
    </div>
    
    <div class="text-end mb-3">
        <button class="btn btn-success btn-sm" onclick="showAddFloorModal()">
            <i class="fas fa-plus"></i> Add Floor
        </button>
    </div>

    <div class="floors-container" id="floorsContainer">
        <!-- Floors will be dynamically generated -->
    </div>

    <div class="parking-info">
        <div class="stats">
            <div class="stat-item">
                <h4 id="totalSpots">150</h4>
                <span>Total Spots</span>
            </div>
            <div class="stat-item">
                <h4 id="availableSpots">0</h4>
                <span>Available</span>
            </div>
            <div class="stat-item">
                <h4 id="occupiedSpots">0</h4>
                <span>Occupied</span>
            </div>
            <div class="stat-item">
                <h4 id="maintenanceSpots">0</h4>
                <span>Maintenance</span>
            </div>
        </div>
    </div>
</div>

<!-- Spot Details Modal -->
<div class="modal fade" id="spotModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="spotModalTitle">Spot Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="spotModalBody">
                <!-- Spot details will be populated here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" id="markAsAvailable" onclick="updateSpotStatus(window.spotId, 'available')">Mark as Available</button>
                <button type="button" class="btn btn-danger" id="markAsOccupied" onclick="updateSpotStatus(window.spotId, 'occupied')">Mark as Occupied</button>
                <button type="button" class="btn btn-warning" id="markAsMaintenance" onclick="updateSpotStatus(window.spotId, 'maintenance')">Mark as Maintenance</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Floor Modal -->
<div class="modal fade" id="addFloorModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Floor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="floorNumber" class="form-label">Floor Number</label>
                    <input type="number" class="form-control" id="floorNumber" min="1" placeholder="6">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addFloor()">Add Floor</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Bay Modal -->
<div class="modal fade" id="addBayModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Bay</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="bayFloorId">
                <div class="mb-3">
                    <label for="bayName" class="form-label">Bay Name</label>
                    <input type="text" class="form-control" id="bayName" placeholder="e.g., Bay D">
                </div>
                <div class="mb-3">
                    <label for="bayLocation" class="form-label">Bay Location</label>
                    <input type="text" class="form-control" id="bayLocation" placeholder="North Wing">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addBay()">Add Bay</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Spot Modal -->
<div class="modal fade" id="addSpotModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Spot</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="spotBayId">
                <input type="hidden" id="spotFloorId">
                <div class="mb-3">
                    <label for="spotName" class="form-label">Spot Name</label>
                    <input type="text" class="form-control" id="spotName" placeholder="e.g., 1A01">
                </div>
                <div class="mb-3">
                    <label for="spotStatus" class="form-label">Initial Status</label>
                    <select class="form-control" id="spotStatus">
                        <option value="available">Available</option>
                        <option value="maintenance">Maintenance</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addSpot()">Add Spot</button>
            </div>
        </div>
    </div>
</div>

<!-- Check In Modal -->
<div class="modal fade" id="checkInModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Check In Car</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="availableCarsList" class="list-group">
                    <!-- Available cars will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
